<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o Dom√©stica</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  :root {
    --bg: #fafafa;
    --surface: #ffffff;
    --border: #e5e7eb;
    --text: #111827;
    --text-light: #6b7280;
    --accent: #2563eb;
    --accent-light: #dbeafe;
    --success: #059669;
    --success-light: #d1fae5;
    --warn: #d97706;
    --warn-light: #fef3c7;
    --danger: #dc2626;
    --danger-light: #fee2e2;
    --shadow: 0 1px 3px rgba(0,0,0,.04);
    --shadow-lg: 0 4px 16px rgba(0,0,0,.06);
  }

  body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    font-size: 14px;
    line-height: 1.6;
  }

  /* LAYOUT */
  #app { display: flex; min-height: 100vh; }
  
  #sidebar {
    width: 240px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 24px 0;
    display: flex;
    flex-direction: column;
  }
  
  .logo {
    padding: 0 20px 20px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 16px;
  }
  .logo h1 {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
  }
  .logo p {
    font-size: 12px;
    color: var(--text-light);
    margin-top: 2px;
  }

  nav { flex: 1; padding: 0 12px; }
  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-light);
    transition: all .15s;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    margin-bottom: 2px;
  }
  .nav-item:hover { background: var(--bg); color: var(--text); }
  .nav-item.active { background: var(--accent-light); color: var(--accent); font-weight: 600; }
  .nav-icon { font-size: 16px; width: 20px; text-align: center; }

  .sidebar-footer {
    padding: 16px 20px;
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text-light);
  }
  .status-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--danger);
    margin-right: 6px;
  }
  .status-dot.ok { background: var(--success); }

  /* MAIN */
  #main { flex: 1; padding: 32px 40px; overflow-y: auto; max-width: 1400px; }

  .page-header {
    margin-bottom: 32px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .page-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 4px;
  }
  .page-subtitle {
    font-size: 14px;
    color: var(--text-light);
  }

  /* VIEWS */
  .view { display: none; }
  .view.active { display: block; }

  /* CARD */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow);
  }
  .card-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 16px;
    text-transform: uppercase;
    letter-spacing: .02em;
  }

  /* GRID */
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px; }
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }

  /* KPI */
  .kpi {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px;
    box-shadow: var(--shadow);
  }
  .kpi-label {
    font-size: 12px;
    color: var(--text-light);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: .03em;
    margin-bottom: 8px;
  }
  .kpi-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
  }
  .kpi-value.blue { color: var(--accent); }
  .kpi-value.green { color: var(--success); }
  .kpi-value.warn { color: var(--warn); }
  .kpi-value.red { color: var(--danger); }
  .kpi-sub {
    font-size: 12px;
    color: var(--text-light);
    margin-top: 6px;
  }

  /* ALERT */
  .alert {
    padding: 14px 16px;
    border-radius: 6px;
    margin-bottom: 12px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    font-size: 13px;
    border-left: 3px solid;
  }
  .alert.info { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
  .alert.success { background: var(--success-light); border-color: var(--success); color: var(--success); }
  .alert.warn { background: var(--warn-light); border-color: var(--warn); color: var(--warn); }
  .alert.danger { background: var(--danger-light); border-color: var(--danger); color: var(--danger); }
  .alert-icon { font-size: 16px; flex-shrink: 0; }
  .alert-content { flex: 1; }
  .alert-title { font-weight: 600; margin-bottom: 2px; }

  /* FORM */
  .form-row { margin-bottom: 16px; }
  .form-row label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 6px;
  }
  .form-row input, .form-row select, .form-row textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
    color: var(--text);
    background: var(--surface);
    transition: border-color .15s;
  }
  .form-row input:focus, .form-row select:focus, .form-row textarea:focus {
    outline: none;
    border-color: var(--accent);
  }
  .form-row textarea { resize: vertical; min-height: 80px; }
  .form-hint { font-size: 12px; color: var(--text-light); margin-top: 4px; }
  .form-inline { display: flex; gap: 12px; }
  .form-inline .form-row { flex: 1; }

  /* BUTTON */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    font-family: inherit;
    transition: all .15s;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: #1d4ed8; }
  .btn-success { background: var(--success); color: white; }
  .btn-success:hover { background: #047857; }
  .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text-light); }
  .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }
  .btn-sm { padding: 6px 12px; font-size: 13px; }
  .btn:disabled { opacity: .5; cursor: not-allowed; }
  .btn-row { display: flex; gap: 8px; margin-top: 20px; flex-wrap: wrap; }

  /* TABLE */
  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; }
  th {
    background: var(--bg);
    padding: 10px 12px;
    text-align: left;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: .03em;
    border-bottom: 1px solid var(--border);
  }
  td {
    padding: 12px 12px;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
  }
  tr:hover td { background: var(--bg); }
  tr:last-child td { border-bottom: none; }

  /* BADGE */
  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .02em;
  }
  .badge-success { background: var(--success-light); color: var(--success); }
  .badge-warn { background: var(--warn-light); color: var(--warn); }
  .badge-danger { background: var(--danger-light); color: var(--danger); }
  .badge-info { background: var(--accent-light); color: var(--accent); }

  /* CALC BOX */
  .calc-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 16px;
    margin-top: 16px;
  }
  .calc-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
  }
  .calc-row:last-child { border-bottom: none; }
  .calc-row.total {
    font-size: 16px;
    font-weight: 700;
    padding-top: 12px;
    margin-top: 8px;
    border-top: 2px solid var(--border);
    border-bottom: none;
  }

  /* MODAL */
  .modal-bg {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.3);
    backdrop-filter: blur(2px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
  }
  .modal-bg.open { display: flex; }
  .modal {
    background: var(--surface);
    border-radius: 8px;
    padding: 28px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
  }
  .modal-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 20px;
  }

  /* LOADER */
  #loader {
    position: fixed;
    inset: 0;
    background: var(--surface);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 200;
  }
  .spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin .8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  #loader p { margin-top: 12px; font-size: 13px; color: var(--text-light); }

  /* SETUP */
  #setup {
    position: fixed;
    inset: 0;
    background: var(--surface);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 150;
    padding: 20px;
  }
  #setup.open { display: flex; }
  .setup-box {
    max-width: 520px;
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 32px;
    box-shadow: var(--shadow-lg);
  }
  .setup-box h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .setup-box > p {
    color: var(--text-light);
    margin-bottom: 24px;
  }

  /* TOAST */
  #toast-wrap {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .toast {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 12px 16px;
    font-size: 13px;
    box-shadow: var(--shadow-lg);
    animation: slide-in .3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    max-width: 320px;
  }
  @keyframes slide-in { from { transform: translateX(20px); opacity: 0; } }
  .toast.success { border-left: 3px solid var(--success); }
  .toast.error { border-left: 3px solid var(--danger); }

  /* INFO BOX */
  .info-box {
    background: var(--accent-light);
    border: 1px solid var(--accent);
    border-radius: 6px;
    padding: 14px 16px;
    font-size: 13px;
    color: var(--accent);
    margin-bottom: 16px;
  }
  .info-box strong { font-weight: 600; }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    #sidebar { width: 60px; }
    .logo p, .nav-item span, .sidebar-footer { display: none; }
    #main { padding: 20px; }
  }
</style>
</head>
<body>

<div id="loader">
  <div class="spinner"></div>
  <p id="loader-msg">Carregando‚Ä¶</p>
</div>

<div id="setup">
  <div class="setup-box">
    <h2>Configura√ß√£o Inicial</h2>
    <p>Configure uma vez ‚Äî os dados ficam no seu Google Drive</p>

    <div class="form-row">
      <label>ID da Planilha Google Sheets</label>
      <input type="text" id="setup-sheet-id" placeholder="Cole o ID aqui">
      <div class="form-hint">Planilha deve estar compartilhada com voc√™ e sua esposa</div>
    </div>

    <div class="form-row">
      <label>Apps Script URL (Web App)</label>
      <input type="text" id="setup-script-url" placeholder="https://script.google.com/...">
      <div class="form-hint">URL da implanta√ß√£o do Apps Script</div>
    </div>

    <div class="form-row">
      <label>Data de Admiss√£o</label>
      <input type="date" id="setup-admissao">
    </div>

    <div class="form-inline">
      <div class="form-row">
        <label>Sal√°rio Base (R$)</label>
        <input type="number" id="setup-salario" step="0.01" placeholder="2000.00">
      </div>
      <div class="form-row">
        <label>Nome (opcional)</label>
        <input type="text" id="setup-nome" placeholder="Ex: Maria">
      </div>
    </div>

    <div class="info-box">
      <strong>Jornada de trabalho:</strong> Configure na pr√≥xima tela ap√≥s salvar
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="saveSetup()">Salvar e Come√ßar</button>
    </div>
  </div>
</div>

<div class="modal-bg" id="modal-bg" onclick="closeModal(event)">
  <div class="modal" id="modal-content"></div>
</div>

<div id="toast-wrap"></div>

<div id="app">
  <aside id="sidebar">
    <div class="logo">
      <h1>Gest√£o Dom√©stica</h1>
      <p>Sistema pessoal</p>
    </div>
    <nav>
      <button class="nav-item active" data-view="dashboard" onclick="goTo('dashboard')">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </button>
      <button class="nav-item" data-view="pagamento" onclick="goTo('pagamento')">
        <span class="nav-icon">üí∞</span>
        <span>Pagamentos</span>
      </button>
      <button class="nav-item" data-view="horas" onclick="goTo('horas')">
        <span class="nav-icon">‚è±Ô∏è</span>
        <span>Horas Extras</span>
      </button>
      <button class="nav-item" data-view="ferias" onclick="goTo('ferias')">
        <span class="nav-icon">üå¥</span>
        <span>F√©rias</span>
      </button>
      <button class="nav-item" data-view="decimo" onclick="goTo('decimo')">
        <span class="nav-icon">üéÅ</span>
        <span>13¬∞ Sal√°rio</span>
      </button>
      <button class="nav-item" data-view="encargos" onclick="goTo('encargos')">
        <span class="nav-icon">üèõÔ∏è</span>
        <span>DAE/Encargos</span>
      </button>
      <button class="nav-item" data-view="faltas" onclick="goTo('faltas')">
        <span class="nav-icon">üìÖ</span>
        <span>Faltas</span>
      </button>
      <button class="nav-item" data-view="rescisao" onclick="goTo('rescisao')">
        <span class="nav-icon">‚ùå</span>
        <span>Rescis√£o</span>
      </button>
      <button class="nav-item" data-view="config" onclick="goTo('config')">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span>Configura√ß√µes</span>
      </button>
    </nav>
    <div class="sidebar-footer">
      <div><span class="status-dot" id="status-dot"></span><span id="status-label">Offline</span></div>
      <div style="margin-top:4px;font-size:11px" id="sync-time"></div>
    </div>
  </aside>

  <main id="main">

    <!-- DASHBOARD -->
    <div class="view active" id="view-dashboard">
      <div class="page-header">
        <div>
          <div class="page-title">Dashboard</div>
          <div class="page-subtitle" id="dash-subtitle">Vis√£o geral</div>
        </div>
        <button class="btn btn-ghost btn-sm" onclick="reloadAll()">üîÑ Atualizar</button>
      </div>

      <div class="grid" id="kpis"></div>
      
      <div class="grid-2">
        <div class="card">
          <div class="card-title">Alertas</div>
          <div id="alerts"></div>
        </div>
        <div class="card">
          <div class="card-title">√öltimos Pagamentos</div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>M√™s</th><th>L√≠quido</th><th>Status</th></tr></thead>
              <tbody id="tb-ultimos"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGAMENTOS -->
    <div class="view" id="view-pagamento">
      <div class="page-header">
        <div>
          <div class="page-title">Pagamentos Mensais</div>
          <div class="page-subtitle">Registre e calcule a folha do m√™s</div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Novo Pagamento</div>
          
          <div class="form-inline">
            <div class="form-row">
              <label>M√™s</label>
              <select id="pag-mes">
                <option value="1">Janeiro</option><option value="2">Fevereiro</option>
                <option value="3">Mar√ßo</option><option value="4">Abril</option>
                <option value="5">Maio</option><option value="6">Junho</option>
                <option value="7">Julho</option><option value="8">Agosto</option>
                <option value="9">Setembro</option><option value="10">Outubro</option>
                <option value="11">Novembro</option><option value="12">Dezembro</option>
              </select>
            </div>
            <div class="form-row">
              <label>Ano</label>
              <input type="number" id="pag-ano" value="2025">
            </div>
          </div>

          <div class="form-inline">
            <div class="form-row">
              <label>H.Extra 50% (minutos)</label>
              <input type="number" id="pag-h50" value="0" min="0" oninput="calcPag()">
              <div class="form-hint" id="pag-h50-hint"></div>
            </div>
            <div class="form-row">
              <label>H.Extra 100% (minutos)</label>
              <input type="number" id="pag-h100" value="0" min="0" oninput="calcPag()">
              <div class="form-hint" id="pag-h100-hint"></div>
            </div>
          </div>

          <div class="form-inline">
            <div class="form-row">
              <label>Faltas (dias)</label>
              <input type="number" id="pag-faltas" value="0" step="0.5" oninput="calcPag()">
            </div>
            <div class="form-row">
              <label>Adiantamento (R$)</label>
              <input type="number" id="pag-adiant" value="0" step="0.01" oninput="calcPag()">
            </div>
          </div>

          <div class="btn-row">
            <button class="btn btn-primary" onclick="savePag()">Salvar Pagamento</button>
          </div>
        </div>

        <div>
          <div class="calc-box" id="calc-pag">
            <div style="font-weight:600;margin-bottom:12px">Demonstrativo</div>
            <div class="calc-row"><span>Sal√°rio Base</span><span id="c-sal">R$ 0</span></div>
            <div class="calc-row"><span>H.Extra 50%</span><span id="c-h50">R$ 0</span></div>
            <div class="calc-row"><span>H.Extra 100%</span><span id="c-h100">R$ 0</span></div>
            <div class="calc-row"><span>Faltas</span><span id="c-faltas" style="color:var(--danger)">R$ 0</span></div>
            <div class="calc-row"><span>INSS</span><span id="c-inss" style="color:var(--danger)">R$ 0</span></div>
            <div class="calc-row"><span>Adiantamento</span><span id="c-adiant" style="color:var(--danger)">R$ 0</span></div>
            <div class="calc-row total"><span>Total L√≠quido</span><span id="c-total">R$ 0</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Hist√≥rico</div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>M√™s/Ano</th><th>Sal√°rio</th><th>H.Extra</th><th>L√≠quido</th><th>Status</th></tr></thead>
            <tbody id="tb-pag"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- HORAS EXTRAS -->
    <div class="view" id="view-horas">
      <div class="page-header">
        <div>
          <div class="page-title">Horas Extras</div>
          <div class="page-subtitle">Registro em minutos</div>
        </div>
        <button class="btn btn-primary" onclick="openModalHE()">+ Nova</button>
      </div>

      <div class="grid">
        <div class="kpi">
          <div class="kpi-label">Pendentes 50%</div>
          <div class="kpi-value warn" id="he-50">0min</div>
          <div class="kpi-sub" id="he-50-val">R$ 0</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Pendentes 100%</div>
          <div class="kpi-value warn" id="he-100">0min</div>
          <div class="kpi-sub" id="he-100-val">R$ 0</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Total a Pagar</div>
          <div class="kpi-value red" id="he-total">R$ 0</div>
        </div>
      </div>

      <div class="info-box">
        üí° <strong>C√°lculo legal (CLT Art. 7¬∫):</strong> Valor hora = Sal√°rio √∑ 220 (divisor fixo para jornada 44h semanais)
      </div>

      <div class="card">
        <div class="card-title">Hist√≥rico</div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Data</th><th>Tipo</th><th>Minutos</th><th>Valor</th><th>Motivo</th><th>Status</th><th></th></tr></thead>
            <tbody id="tb-he"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- F√âRIAS -->
    <div class="view" id="view-ferias">
      <div class="page-header">
        <div>
          <div class="page-title">F√©rias</div>
          <div class="page-subtitle">20 dias por per√≠odo (LC 150/2015)</div>
        </div>
        <button class="btn btn-primary" onclick="openModalFerias()">+ Registrar Gozo</button>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Per√≠odo Atual</div>
          <div id="ferias-atual"></div>
        </div>
        <div class="card">
          <div class="card-title">Simulador</div>
          <div class="form-row">
            <label>Dias de f√©rias</label>
            <input type="number" id="ferias-dias-sim" value="20" min="1" max="20" oninput="calcFerias()">
          </div>
          <div class="calc-box" id="ferias-calc"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Hist√≥rico</div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Per√≠odo</th><th>Gozo In√≠cio</th><th>Dias</th><th>Valor</th><th>Status</th></tr></thead>
            <tbody id="tb-ferias"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 13¬∞ -->
    <div class="view" id="view-decimo">
      <div class="page-header">
        <div>
          <div class="page-title">13¬∞ Sal√°rio</div>
          <div class="page-subtitle">Calculadora autom√°tica</div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Calcular</div>
          <div class="form-inline">
            <div class="form-row">
              <label>Ano</label>
              <input type="number" id="d13-ano" value="2025" oninput="calcDecimo()">
            </div>
            <div class="form-row">
              <label>Avos (meses)</label>
              <input type="number" id="d13-avos" value="12" min="1" max="12" oninput="calcDecimo()">
            </div>
          </div>
          <div class="calc-box" id="d13-calc"></div>
        </div>
        <div class="card">
          <div class="card-title">Hist√≥rico</div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Ano</th><th>Avos</th><th>Total</th><th>Status</th></tr></thead>
              <tbody id="tb-d13"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ENCARGOS -->
    <div class="view" id="view-encargos">
      <div class="page-header">
        <div>
          <div class="page-title">DAE / Encargos</div>
          <div class="page-subtitle">Vencimento: dia 7 de cada m√™s</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Hist√≥rico de Recolhimento</div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>M√™s/Ano</th><th>Base</th><th>FGTS Total</th><th>INSS Total</th><th>DAE</th><th>Vencimento</th><th>Status</th></tr></thead>
            <tbody id="tb-enc"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- FALTAS -->
    <div class="view" id="view-faltas">
      <div class="page-header">
        <div>
          <div class="page-title">Faltas e Aus√™ncias</div>
        </div>
        <button class="btn btn-primary" onclick="openModalFalta()">+ Registrar</button>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead><tr><th>Data</th><th>Tipo</th><th>Dias</th><th>Justificada?</th><th>Desconto</th></tr></thead>
            <tbody id="tb-faltas"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- RESCIS√ÉO -->
    <div class="view" id="view-rescisao">
      <div class="page-header">
        <div>
          <div class="page-title">Calculadora de Rescis√£o</div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Dados</div>
          <div class="form-row">
            <label>Tipo</label>
            <select id="resc-tipo" onchange="calcResc()">
              <option value="sjc">Sem Justa Causa</option>
              <option value="pd">Pedido de Demiss√£o</option>
              <option value="acordo">Acordo M√∫tuo</option>
            </select>
          </div>
          <div class="form-row">
            <label>Data da Demiss√£o</label>
            <input type="date" id="resc-data" oninput="calcResc()">
          </div>
          <div class="form-row">
            <label>Saldo FGTS (R$)</label>
            <input type="number" id="resc-fgts" step="0.01" placeholder="Consultar app FGTS" oninput="calcResc()">
          </div>
        </div>
        <div class="calc-box" id="resc-calc"></div>
      </div>
    </div>

    <!-- CONFIG -->
    <div class="view" id="view-config">
      <div class="page-header">
        <div>
          <div class="page-title">Configura√ß√µes</div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Contrato</div>
          <div class="form-row">
            <label>Nome (opcional)</label>
            <input type="text" id="cfg-nome">
          </div>
          <div class="form-row">
            <label>Data de Admiss√£o</label>
            <input type="date" id="cfg-admissao">
          </div>
          <div class="form-row">
            <label>Sal√°rio Base (R$)</label>
            <input type="number" id="cfg-salario" step="0.01">
          </div>
          <div class="btn-row">
            <button class="btn btn-primary" onclick="saveCfg()">Salvar</button>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Jornada de Trabalho</div>
          
          <div class="info-box">
            Configure as horas trabalhadas por dia da semana
          </div>

          <div class="form-row">
            <label>Segunda a Sexta</label>
            <div class="form-inline">
              <input type="number" id="cfg-hr-seg-sex" value="8" min="0" max="12" placeholder="Horas">
              <input type="number" id="cfg-int-seg-sex" value="120" min="0" max="240" placeholder="Intervalo (min)">
            </div>
            <div class="form-hint">8h de trabalho + 120min de intervalo = 10h no local</div>
          </div>

          <div class="form-row">
            <label>S√°bado</label>
            <div class="form-inline">
              <input type="number" id="cfg-hr-sab" value="4" min="0" max="12" placeholder="Horas">
              <input type="number" id="cfg-int-sab" value="0" min="0" max="240" placeholder="Intervalo (min)">
            </div>
            <div class="form-hint">4h de trabalho + 0min intervalo</div>
          </div>

          <div class="form-row">
            <label>Domingo</label>
            <div class="form-inline">
              <input type="number" id="cfg-hr-dom" value="0" min="0" max="12" placeholder="Horas">
              <input type="number" id="cfg-int-dom" value="0" min="0" max="240" placeholder="Intervalo (min)">
            </div>
          </div>

          <div class="btn-row">
            <button class="btn btn-primary" onclick="saveJornada()">Salvar Jornada</button>
          </div>

          <div style="margin-top:20px;padding:12px;background:var(--bg);border-radius:6px;font-size:12px">
            <div style="font-weight:600;margin-bottom:8px">Carga Semanal</div>
            <div id="cfg-carga-total" style="color:var(--text-light)">‚Äî</div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Sistema & Cache</div>
          
          <div class="info-box">
            üìå Dados ficam no Google Drive. Cache local guarda apenas IDs de conex√£o.
          </div>

          <div class="form-row">
            <label>ID da Planilha</label>
            <input type="text" id="cfg-sheet-id" readonly style="background:var(--bg);color:var(--text-light);font-size:11px">
          </div>

          <div class="form-row">
            <label>Apps Script URL</label>
            <input type="text" id="cfg-script-url" readonly style="background:var(--bg);color:var(--text-light);font-size:11px">
          </div>

          <div class="btn-row">
            <button class="btn btn-ghost" onclick="reloadAll()">üîÑ Recarregar Dados</button>
            <button class="btn btn-ghost" onclick="clearCache()">üóëÔ∏è Limpar Cache</button>
          </div>

          <div style="margin-top:16px;padding:12px;background:var(--warn-light);border:1px solid var(--warn);border-radius:6px;font-size:12px;color:var(--warn)">
            <strong>‚ö†Ô∏è Limpar Cache:</strong> Remove configura√ß√µes locais. Voc√™ precisar√° configurar novamente.
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG & STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LS = 'gestao_cfg';
let CFG = {};
let DATA = {config:null, pagamentos:[], horasExtras:[], ferias:[], decimo:[], faltas:[], encargos:[]};

const R = (v) => 'R$ ' + (Number(v)||0).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
const NUM = (v) => Number(String(v).replace(',','.')) || 0;
const PAD = (n) => String(n).padStart(2,'0');
const MESES = ['','Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

function minToHM(min) {
  min = Math.round(min);
  const h = Math.floor(min/60), m = min%60;
  if (h === 0) return `${m}min`;
  if (m === 0) return `${h}h`;
  return `${h}h${PAD(m)}min`;
}

function fmtDate(d) {
  if (!d) return '‚Äî';
  if (typeof d === 'string' && d.includes('/')) return d;
  const dt = new Date(d);
  if (isNaN(dt)) return d;
  return `${PAD(dt.getDate())}/${PAD(dt.getMonth()+1)}/${dt.getFullYear()}`;
}

function dateFromStr(s) {
  if (!s) return null;
  if (s instanceof Date) return s;
  if (typeof s === 'number') return new Date(1899, 11, 30 + s);
  const parts = s.toString().split(/[-\/]/);
  if (parts.length === 3) {
    if (parts[0].length === 4) return new Date(parts[0], parts[1]-1, parts[2]);
    return new Date(parts[2], parts[1]-1, parts[0]);
  }
  return new Date(s);
}

function diffMonths(d1, d2) {
  return (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth());
}

// INSS 2025 progressivo
function calcINSS(sal) {
  const s = NUM(sal);
  let inss = 0;
  const faixas = [
    {ate: 1518.00, aliq: 0.075},
    {ate: 2793.88, aliq: 0.09},
    {ate: 4190.83, aliq: 0.12},
    {ate: 8157.41, aliq: 0.14},
  ];
  let prev = 0;
  for (const f of faixas) {
    if (s <= prev) break;
    const base = Math.min(s, f.ate) - prev;
    inss += base * f.aliq;
    prev = f.ate;
    if (s <= f.ate) break;
  }
  return Math.min(inss, s);
}

// Hora extra value - CORRECT Brazilian labor law formula
// For 44h/week, divisor is ALWAYS 220 (CLT Art. 7¬∫)
function calcHE(salario, minutos, tipo) {
  const s = NUM(salario);
  const DIVISOR_44H = 220; // Fixed by law for 44h workweek
  const valorHora = s / DIVISOR_44H;
  
  // Accept multiple formats: "50%", "0.5", 0.5
  let adicional = 1.5; // default 50%
  if (tipo === '100%' || tipo === '1' || tipo === 1 || tipo === '1.0') {
    adicional = 2.0;
  }
  
  return valorHora * (minutos / 60) * adicional;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getLoc() {
  try { return JSON.parse(localStorage.getItem(LS) || '{}'); } catch { return {}; }
}
function setLoc(obj) { 
  // Only save connection config, never data
  const toSave = {
    sheetId: obj.sheetId,
    scriptUrl: obj.scriptUrl,
    admissao: obj.admissao,
    salario: obj.salario,
    nome: obj.nome,
    hrSegFex: obj.hrSegFex,
    intSegFex: obj.intSegFex,
    hrSab: obj.hrSab,
    intSab: obj.intSab,
    hrDom: obj.hrDom,
    intDom: obj.intDom
  };
  localStorage.setItem(LS, JSON.stringify(toSave));
}

function clearCache() {
  if (confirm('Limpar cache? Voc√™ precisar√° configurar novamente.')) {
    localStorage.clear();
    location.reload();
  }
}

async function readSheet(sheet, range) {
  const cfg = getLoc();
  if (!cfg.sheetId) throw new Error('Sheet ID n√£o configurado');
  const url = `https://docs.google.com/spreadsheets/d/${cfg.sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheet)}&range=${range||''}`;
  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error('Erro ao ler planilha');
  const text = await res.text();
  const json = JSON.parse(text.replace(/^[^{]*/, '').replace(/[^}]*$/, ''));
  return json;
}

async function writeSheet(action, payload) {
  const cfg = getLoc();
  if (!cfg.scriptUrl) throw new Error('Apps Script URL n√£o configurado');
  const body = JSON.stringify({ action, payload });
  const res = await fetch(cfg.scriptUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain' },
    body
  });
  if (!res.ok) throw new Error('Erro ao salvar');
  return await res.json();
}

function parseRows(json) {
  const cols = json.table.cols.map(c => c.label || c.id);
  return (json.table.rows || []).map(row => {
    const obj = {};
    (row.c || []).forEach((cell, i) => {
      obj[cols[i]] = cell ? (cell.v !== undefined ? cell.v : null) : null;
    });
    return obj;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('DOMContentLoaded', async () => {
  CFG = getLoc();
  if (!CFG.sheetId || !CFG.scriptUrl) {
    hideLoader();
    document.getElementById('setup').classList.add('open');
    return;
  }
  await reloadAll();
});

async function reloadAll() {
  showLoader();
  try {
    await loadAllData();
    setStatus(true);
    renderAll();
  } catch(e) {
    setStatus(false);
    toast('Erro: ' + e.message, 'error');
  }
  hideLoader();
}

async function loadAllData() {
  // ALWAYS load from sheets, never from cache
  console.log('üîÑ Carregando dados da planilha...');
  
  // Reset DATA to ensure fresh load
  DATA = {config:null, pagamentos:[], horasExtras:[], ferias:[], decimo:[], faltas:[], encargos:[]};
  
  // config
  try {
    const r = await readSheet('config', 'A:Z');
    const rows = parseRows(r);
    if (rows.length > 0) {
      DATA.config = rows[0];
      if (DATA.config) {
        // Update CFG with server data
        CFG.admissao = DATA.config.admissao || CFG.admissao;
        CFG.salario = DATA.config.salario || CFG.salario;
        CFG.nome = DATA.config.nome || CFG.nome;
        CFG.hrSegFex = DATA.config.hrSegFex || CFG.hrSegFex || 8;
        CFG.intSegFex = DATA.config.intSegFex || CFG.intSegFex || 120;
        CFG.hrSab = DATA.config.hrSab || CFG.hrSab || 4;
        CFG.intSab = DATA.config.intSab || CFG.intSab || 0;
        CFG.hrDom = DATA.config.hrDom || CFG.hrDom || 0;
        CFG.intDom = DATA.config.intDom || CFG.intDom || 0;
        // Save only connection config
        setLoc(CFG);
      }
    }
  } catch(e) { console.warn('Config:', e.message); }

  const sheets = ['pagamentos','horasExtras','ferias','decimo','faltas','encargos'];
  await Promise.allSettled(sheets.map(async (s) => {
    try {
      const r = await readSheet(s, 'A:Z');
      DATA[s] = parseRows(r).filter(row => Object.values(row).some(v => v !== null));
      console.log(`‚úì ${s}: ${DATA[s].length} registros`);
    } catch(e) { 
      console.warn(`‚úó ${s}:`, e.message); 
      DATA[s] = []; 
    }
  }));
  
  console.log('‚úÖ Dados carregados:', {
    pagamentos: DATA.pagamentos.length,
    horasExtras: DATA.horasExtras.length,
    ferias: DATA.ferias.length,
    decimo: DATA.decimo.length,
    faltas: DATA.faltas.length,
    encargos: DATA.encargos.length
  });
}

function renderAll() {
  populateCfg();
  renderDash();
  renderPag();
  renderHE();
  renderFerias();
  renderDecimo();
  renderEnc();
  renderFaltas();
  calcPag();
  calcFerias();
  calcDecimo();
  calcResc();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveSetup() {
  const sheetId = document.getElementById('setup-sheet-id').value.trim();
  const scriptUrl = document.getElementById('setup-script-url').value.trim();
  const admissao = document.getElementById('setup-admissao').value;
  const salario = document.getElementById('setup-salario').value;
  const nome = document.getElementById('setup-nome').value;

  if (!sheetId || !scriptUrl || !admissao || !salario) {
    toast('Preencha os campos obrigat√≥rios','error'); return;
  }

  const cfg = {
    sheetId, scriptUrl, admissao, salario: NUM(salario), nome,
    hrSegFex: 8, intSegFex: 120, hrSab: 4, intSab: 0, hrDom: 0, intDom: 0
  };
  setLoc(cfg);
  CFG = cfg;

  try {
    showLoader();
    await writeSheet('saveConfig', cfg);
    document.getElementById('setup').classList.remove('open');
    await reloadAll();
    toast('Configurado!','success');
  } catch(e) {
    toast('Erro: ' + e.message,'error');
    hideLoader();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function populateCfg() {
  document.getElementById('cfg-nome').value = CFG.nome || '';
  document.getElementById('cfg-admissao').value = CFG.admissao || '';
  document.getElementById('cfg-salario').value = CFG.salario || '';
  document.getElementById('cfg-hr-seg-sex').value = CFG.hrSegFex || 8;
  document.getElementById('cfg-int-seg-sex').value = CFG.intSegFex || 120;
  document.getElementById('cfg-hr-sab').value = CFG.hrSab || 4;
  document.getElementById('cfg-int-sab').value = CFG.intSab || 0;
  document.getElementById('cfg-hr-dom').value = CFG.hrDom || 0;
  document.getElementById('cfg-int-dom').value = CFG.intDom || 0;
  
  // Show connection IDs
  const sheetIdEl = document.getElementById('cfg-sheet-id');
  const scriptUrlEl = document.getElementById('cfg-script-url');
  if (sheetIdEl) sheetIdEl.value = CFG.sheetId || 'N√£o configurado';
  if (scriptUrlEl) scriptUrlEl.value = CFG.scriptUrl || 'N√£o configurado';
  
  updateCargaTotal();
}

function updateCargaTotal() {
  const hrSF = NUM(document.getElementById('cfg-hr-seg-sex')?.value) || 8;
  const hrSab = NUM(document.getElementById('cfg-hr-sab')?.value) || 4;
  const hrDom = NUM(document.getElementById('cfg-hr-dom')?.value) || 0;
  const total = hrSF * 5 + hrSab + hrDom;
  const el = document.getElementById('cfg-carga-total');
  if(el) el.textContent = `${total}h semanais (${hrSF}h √ó seg-sex + ${hrSab}h s√°b + ${hrDom}h dom)`;
}

async function saveCfg() {
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Salvando...';
  
  const cfg = {
    ...getLoc(),
    nome: document.getElementById('cfg-nome').value,
    admissao: document.getElementById('cfg-admissao').value,
    salario: NUM(document.getElementById('cfg-salario').value),
  };
  setLoc(cfg);
  CFG = cfg;
  try {
    await writeSheet('saveConfig', cfg);
    toast('Salvo!','success');
    await loadAllData();
    renderAll();
    btn.disabled = false;
    btn.textContent = 'Salvar';
  } catch(e) { 
    toast('Erro: ' + e.message,'error');
    btn.disabled = false;
    btn.textContent = 'Salvar';
  }
}

async function saveJornada() {
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Salvando...';
  
  const cfg = {
    ...getLoc(),
    hrSegFex: NUM(document.getElementById('cfg-hr-seg-sex').value),
    intSegFex: NUM(document.getElementById('cfg-int-seg-sex').value),
    hrSab: NUM(document.getElementById('cfg-hr-sab').value),
    intSab: NUM(document.getElementById('cfg-int-sab').value),
    hrDom: NUM(document.getElementById('cfg-hr-dom').value),
    intDom: NUM(document.getElementById('cfg-int-dom').value),
  };
  setLoc(cfg);
  CFG = cfg;
  try {
    await writeSheet('saveConfig', cfg);
    toast('Jornada salva!','success');
    await loadAllData();
    renderAll();
    btn.disabled = false;
    btn.textContent = 'Salvar Jornada';
  } catch(e) { 
    toast('Erro: ' + e.message,'error');
    btn.disabled = false;
    btn.textContent = 'Salvar Jornada';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDash() {
  const now = new Date();
  const salario = NUM(CFG.salario);
  const admissao = dateFromStr(CFG.admissao);
  
  document.getElementById('dash-subtitle').textContent = 
    `${MESES[now.getMonth()+1]} ${now.getFullYear()} ${CFG.nome ? '‚Äî ' + CFG.nome : ''}`;

  // KPIs
  const hePend = DATA.horasExtras.filter(h => (h.status||'').toLowerCase() === 'pendente');
  const he50 = hePend.filter(h => h.tipo === '50%').reduce((s,h) => s + NUM(h.minutos), 0);
  const he100 = hePend.filter(h => h.tipo === '100%').reduce((s,h) => s + NUM(h.minutos), 0);
  const heVal = calcHE(salario, he50, '50%') + calcHE(salario, he100, '100%');
  
  const inss = calcINSS(salario);
  const daeVal = salario * (0.08 + 0.032 + 0.08 + 0.008) + inss;

  let feriasInfo = '‚Äî';
  if (admissao && !isNaN(admissao)) {
    const meses = diffMonths(admissao, now);
    const periodo = Math.floor(meses / 12);
    const feriasGoz = DATA.ferias.filter(f => Number(f.periodo) === periodo).reduce((s,f) => s + NUM(f.dias), 0);
    feriasInfo = `${Math.max(0, 20 - feriasGoz)} dias`;
  }

  const kpis = [
    { label: 'Sal√°rio Base', value: R(salario), sub: admissao ? 'Desde ' + fmtDate(admissao) : '', cls: 'blue' },
    { label: 'DAE Este M√™s', value: R(daeVal), sub: 'Vence dia 7', cls: 'warn' },
    { label: 'H. Extras Pendentes', value: hePend.length > 0 ? R(heVal) : R(0), sub: `${hePend.length} registro(s)`, cls: hePend.length > 0 ? 'red' : 'green' },
    { label: 'F√©rias Dispon√≠veis', value: feriasInfo, sub: 'Per√≠odo atual', cls: 'green' },
  ];

  document.getElementById('kpis').innerHTML = kpis.map(k => `
    <div class="kpi">
      <div class="kpi-label">${k.label}</div>
      <div class="kpi-value ${k.cls}">${k.value}</div>
      <div class="kpi-sub">${k.sub}</div>
    </div>
  `).join('');

  // Alertas
  const alerts = [];
  const vencDAE = new Date(now.getFullYear(), now.getMonth() + 1, 7);
  const diasVenc = Math.floor((vencDAE - now) / 86400000);
  if (diasVenc <= 7) {
    alerts.push({ type: diasVenc <= 3 ? 'danger' : 'warn', icon: 'üö®', title: `DAE vence em ${diasVenc} dia(s)`, desc: R(daeVal) });
  }
  if (hePend.length > 0) {
    alerts.push({ type: 'warn', icon: '‚è±Ô∏è', title: `${hePend.length} horas extras pendentes`, desc: `Incluir na pr√≥xima folha: ${R(heVal)}` });
  }

  const mes = now.getMonth() + 1;
  const pagMes = DATA.pagamentos.find(p => Number(p.mes) === mes && Number(p.ano) === now.getFullYear());
  if (!pagMes) {
    alerts.push({ type: 'info', icon: 'üí∞', title: 'Folha do m√™s n√£o registrada', desc: `Registre o pagamento de ${MESES[mes]}` });
  }

  if (alerts.length === 0) {
    alerts.push({ type: 'success', icon: '‚úÖ', title: 'Tudo em dia', desc: 'Nenhum alerta no momento' });
  }

  document.getElementById('alerts').innerHTML = alerts.slice(0,4).map(a => `
    <div class="alert ${a.type}">
      <div class="alert-icon">${a.icon}</div>
      <div class="alert-content">
        <div class="alert-title">${a.title}</div>
        <div>${a.desc}</div>
      </div>
    </div>
  `).join('');

  // √öltimos pagamentos
  const tb = document.getElementById('tb-ultimos');
  const pags = [...DATA.pagamentos].slice(-5).reverse();
  if (!pags.length) {
    tb.innerHTML = '<tr><td colspan="3" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
  } else {
    tb.innerHTML = pags.map(p => `
      <tr>
        <td>${MESES[NUM(p.mes)]}/${p.ano}</td>
        <td style="font-weight:600">${R(p.total)}</td>
        <td><span class="badge badge-${(p.status||'pendente').toLowerCase() === 'pago' ? 'success' : 'warn'}">${p.status||'Pendente'}</span></td>
      </tr>
    `).join('');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGAMENTO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcPag() {
  const salario = NUM(CFG.salario);
  const h50 = NUM(document.getElementById('pag-h50')?.value);
  const h100 = NUM(document.getElementById('pag-h100')?.value);
  const faltas = NUM(document.getElementById('pag-faltas')?.value);
  const adiant = NUM(document.getElementById('pag-adiant')?.value);

  const ve50 = calcHE(salario, h50, '50%');
  const ve100 = calcHE(salario, h100, '100%');
  const descFaltas = salario / 30 * faltas;
  const bruto = salario + ve50 + ve100;
  const inss = calcINSS(bruto - descFaltas);
  const liquido = bruto - descFaltas - inss - adiant;

  const h50El = document.getElementById('pag-h50-hint');
  const h100El = document.getElementById('pag-h100-hint');
  if(h50El) h50El.textContent = h50 > 0 ? minToHM(h50) + ' = ' + R(ve50) : '';
  if(h100El) h100El.textContent = h100 > 0 ? minToHM(h100) + ' = ' + R(ve100) : '';

  document.getElementById('c-sal').textContent = R(salario);
  document.getElementById('c-h50').textContent = R(ve50);
  document.getElementById('c-h100').textContent = R(ve100);
  document.getElementById('c-faltas').textContent = '‚àí ' + R(descFaltas);
  document.getElementById('c-inss').textContent = '‚àí ' + R(inss);
  document.getElementById('c-adiant').textContent = '‚àí ' + R(adiant);
  document.getElementById('c-total').textContent = R(liquido);

  return { salario, ve50, ve100, descFaltas, inss, liquido, h50, h100, faltas, adiant, bruto };
}

async function savePag() {
  const vals = calcPag();
  const mes = document.getElementById('pag-mes').value;
  const ano = document.getElementById('pag-ano').value;

  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Salvando...';

  const row = {
    mes, ano,
    salarioBase: vals.salario,
    hExtras50min: vals.h50,
    hExtras100min: vals.h100,
    faltas: vals.faltas,
    adiantamento: vals.adiant,
    inss: vals.inss,
    total: vals.liquido,
    status: 'Pendente'
  };

  try {
    await writeSheet('savePagamento', row);
    toast('Salvo!','success');
    await loadAllData();
    renderPag();
    renderDash();
    // Salvar encargo
    const enc = {
      mes, ano,
      baseCalculo: vals.bruto,
      fgts8: vals.bruto * 0.08,
      fgts32: vals.bruto * 0.032,
      inssPatronal: vals.bruto * 0.08,
      rat: vals.bruto * 0.008,
      inssFunc: vals.inss,
      total: vals.bruto * (0.08+0.032+0.08+0.008) + vals.inss,
      vencimento: fmtDate(new Date(Number(ano), Number(mes), 7)),
      status: 'Pendente'
    };
    await writeSheet('saveEncargo', enc);
    renderEnc();
    btn.disabled = false;
    btn.textContent = 'Salvar Pagamento';
  } catch(e) { 
    toast('Erro: ' + e.message, 'error');
    btn.disabled = false;
    btn.textContent = 'Salvar Pagamento';
  }
}

function renderPag() {
  const tb = document.getElementById('tb-pag');
  if (!DATA.pagamentos.length) {
    tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
    return;
  }
  tb.innerHTML = [...DATA.pagamentos].reverse().map(p => `
    <tr>
      <td>${MESES[NUM(p.mes)]}/${p.ano}</td>
      <td>${R(p.salarioBase)}</td>
      <td>${p.hExtras50min ? minToHM(NUM(p.hExtras50min)) : '‚Äî'}</td>
      <td style="font-weight:600">${R(p.total)}</td>
      <td><span class="badge badge-${(p.status||'pendente').toLowerCase() === 'pago' ? 'success' : 'warn'}">${p.status||'Pendente'}</span></td>
    </tr>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HORAS EXTRAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHE() {
  const salario = NUM(CFG.salario);
  const hePend = DATA.horasExtras.filter(h => (h.status||'').toLowerCase() === 'pendente');
  const he50 = hePend.filter(h => h.tipo === '50%').reduce((s,h) => s + NUM(h.minutos), 0);
  const he100 = hePend.filter(h => h.tipo === '100%').reduce((s,h) => s + NUM(h.minutos), 0);
  const val50 = calcHE(salario, he50, '50%');
  const val100 = calcHE(salario, he100, '100%');

  document.getElementById('he-50').textContent = minToHM(he50);
  document.getElementById('he-50-val').textContent = R(val50);
  document.getElementById('he-100').textContent = minToHM(he100);
  document.getElementById('he-100-val').textContent = R(val100);
  document.getElementById('he-total').textContent = R(val50 + val100);

  const tb = document.getElementById('tb-he');
  if (!DATA.horasExtras.length) {
    tb.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
    return;
  }
  tb.innerHTML = [...DATA.horasExtras].reverse().map((h, i) => {
    const val = h.tipo === '50%' ? calcHE(salario, NUM(h.minutos), '50%') : calcHE(salario, NUM(h.minutos), '100%');
    return `
      <tr>
        <td>${fmtDate(h.data)}</td>
        <td><span class="badge badge-${h.tipo==='50%'?'warn':'danger'}">${h.tipo}</span></td>
        <td>${h.minutos}min</td>
        <td style="font-weight:600">${R(val)}</td>
        <td style="color:var(--text-light)">${h.motivo||'‚Äî'}</td>
        <td><span class="badge badge-${(h.status||'pendente').toLowerCase()==='pago'?'success':'warn'}">${h.status||'Pendente'}</span></td>
        <td><button class="btn btn-ghost btn-sm" onclick="markHE(${DATA.horasExtras.length-1-i},'Pago')">‚úì</button></td>
      </tr>
    `;
  }).join('');
}

function openModalHE() {
  const now = new Date();
  const today = `${now.getFullYear()}-${PAD(now.getMonth()+1)}-${PAD(now.getDate())}`;
  openModal(`
    <div class="modal-title">Nova Hora Extra</div>
    <div class="form-row">
      <label>Data</label>
      <input type="date" id="m-he-data" value="${today}">
    </div>
    <div class="form-inline">
      <div class="form-row">
        <label>Tipo</label>
        <select id="m-he-tipo">
          <option value="50%">50% ‚Äî Dias √∫teis (seg-sex)</option>
          <option value="100%">100% ‚Äî Domingo/Feriado/Noturna</option>
        </select>
      </div>
      <div class="form-row">
        <label>Minutos</label>
        <input type="number" id="m-he-min" min="1" placeholder="90" oninput="previewHE()">
      </div>
    </div>
    <div style="margin-top:8px;font-size:13px;font-weight:600;color:var(--accent)" id="m-he-preview"></div>
    <div class="form-row">
      <label>Motivo</label>
      <input type="text" id="m-he-motivo" placeholder="Ex: evento, servi√ßo extra">
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="saveHE()">Salvar</button>
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

function previewHE() {
  const min = NUM(document.getElementById('m-he-min')?.value);
  const tipo = document.getElementById('m-he-tipo')?.value;
  if (!min) return;
  const salario = NUM(CFG.salario);
  const val = calcHE(salario, min, tipo);
  const el = document.getElementById('m-he-preview');
  if (el) el.textContent = `${minToHM(min)} = ${R(val)}`;
}

async function saveHE() {
  const data = document.getElementById('m-he-data').value;
  const tipo = document.getElementById('m-he-tipo').value;
  const min = NUM(document.getElementById('m-he-min').value);
  const motivo = document.getElementById('m-he-motivo').value;
  if (!data || min <= 0) { toast('Preencha data e minutos','error'); return; }
  
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Salvando...';
  
  try {
    await writeSheet('saveHoraExtra', { data, tipo, minutos: min, motivo, status: 'Pendente' });
    toast('Salvo!','success');
    closeModal();
    await loadAllData();
    renderHE();
    renderDash();
  } catch(e) { 
    toast('Erro: ' + e.message,'error');
    btn.disabled = false;
    btn.textContent = 'Salvar';
  }
}

async function markHE(idx, status) {
  const h = DATA.horasExtras[idx];
  if (!h) return;
  
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = '...';
  
  try {
    await writeSheet('updateHEStatus', { data: h.data, tipo: h.tipo, minutos: h.minutos, status });
    toast('Atualizado!','success');
    await loadAllData();
    renderHE();
    renderDash();
  } catch(e) { 
    toast('Erro: '+e.message,'error');
    btn.disabled = false;
    btn.textContent = '‚úì';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// F√âRIAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFerias() {
  const admissao = dateFromStr(CFG.admissao);
  const now = new Date();
  if (admissao && !isNaN(admissao)) {
    const meses = diffMonths(admissao, now);
    const periodo = Math.floor(meses / 12);
    const mesesNoPeriodo = meses % 12;
    const feriasGoz = DATA.ferias.filter(f => Number(f.periodo) === periodo).reduce((s,f) => s + NUM(f.dias), 0);
    const saldo = 20 - feriasGoz;

    document.getElementById('ferias-atual').innerHTML = `
      <div style="font-size:32px;font-weight:700;color:var(--success);margin-bottom:8px">${Math.max(0, saldo)} dias</div>
      <div style="color:var(--text-light);font-size:13px">Saldo do ${periodo+1}¬∞ per√≠odo (${mesesNoPeriodo}/12 meses)</div>
    `;
  } else {
    document.getElementById('ferias-atual').innerHTML = '<div style="color:var(--text-light)">Configure a data de admiss√£o</div>';
  }

  const tb = document.getElementById('tb-ferias');
  if (!DATA.ferias.length) {
    tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
    return;
  }
  tb.innerHTML = DATA.ferias.map(f => `
    <tr>
      <td>${f.periodo ? f.periodo+'¬∞' : '‚Äî'}</td>
      <td>${fmtDate(f.gozoInicio)}</td>
      <td>${f.dias || 20}</td>
      <td style="font-weight:600">${R(f.valor)}</td>
      <td><span class="badge badge-${(f.status||'pendente').toLowerCase()==='gozadas'?'info':'warn'}">${f.status||'Pendente'}</span></td>
    </tr>
  `).join('');
}

function calcFerias() {
  const salario = NUM(CFG.salario);
  const dias = NUM(document.getElementById('ferias-dias-sim')?.value) || 20;
  const rem = salario / 30 * dias;
  const terco = rem / 3;
  const total = rem + terco;

  document.getElementById('ferias-calc').innerHTML = `
    <div class="calc-row"><span>Remunera√ß√£o (${dias}d)</span><span>${R(rem)}</span></div>
    <div class="calc-row"><span>+ 1/3 Constitucional</span><span>${R(terco)}</span></div>
    <div class="calc-row total"><span>Total</span><span>${R(total)}</span></div>
  `;
}

function openModalFerias() {
  const now = new Date();
  const today = `${now.getFullYear()}-${PAD(now.getMonth()+1)}-${PAD(now.getDate())}`;
  openModal(`
    <div class="modal-title">Registrar F√©rias</div>
    <div class="form-row">
      <label>In√≠cio do Gozo</label>
      <input type="date" id="m-f-inicio" value="${today}">
    </div>
    <div class="form-row">
      <label>Dias</label>
      <input type="number" id="m-f-dias" value="20" min="1" max="20">
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="saveFerias()">Salvar</button>
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

async function saveFerias() {
  const inicio = document.getElementById('m-f-inicio').value;
  const dias = NUM(document.getElementById('m-f-dias').value);
  if (!inicio || !dias) { toast('Preencha os campos','error'); return; }

  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Salvando...';

  const salario = NUM(CFG.salario);
  const rem = salario / 30 * dias;
  const terco = rem / 3;
  const valor = rem + terco;

  const admissao = dateFromStr(CFG.admissao);
  const now = new Date();
  const meses = diffMonths(admissao, now);
  const periodo = Math.floor(meses / 12);

  const row = { gozoInicio: inicio, dias, valor, status: 'Pendente', periodo };
  try {
    await writeSheet('saveFerias', row);
    toast('Salvo!','success');
    closeModal();
    await loadAllData();
    renderFerias();
    renderDash();
  } catch(e) { 
    toast('Erro: '+e.message,'error');
    btn.disabled = false;
    btn.textContent = 'Salvar';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 13¬∞
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcDecimo() {
  const salario = NUM(CFG.salario);
  const avos = NUM(document.getElementById('d13-avos')?.value) || 12;
  const total = salario / 12 * avos;
  const p1 = total / 2;
  const p2 = total - p1;
  const inss = calcINSS(total);
  const p2liq = p2 - inss;

  document.getElementById('d13-calc').innerHTML = `
    <div class="calc-row"><span>Total (sal√∑12√óavos)</span><span>${R(total)}</span></div>
    <div class="calc-row"><span>1¬™ Parcela (50%)</span><span>${R(p1)}</span></div>
    <div class="calc-row"><span>2¬™ Parcela bruta</span><span>${R(p2)}</span></div>
    <div class="calc-row"><span>‚àí INSS (9%)</span><span style="color:var(--danger)">‚àí ${R(inss)}</span></div>
    <div class="calc-row total"><span>2¬™ Parcela L√≠quida</span><span>${R(p2liq)}</span></div>
  `;
}

function renderDecimo() {
  const tb = document.getElementById('tb-d13');
  if (!DATA.decimo.length) {
    tb.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
    return;
  }
  tb.innerHTML = [...DATA.decimo].reverse().map(d => `
    <tr>
      <td>${d.ano}</td>
      <td>${d.avos||12}/12</td>
      <td style="font-weight:600">${R(NUM(d.parcela1) + NUM(d.parcela2))}</td>
      <td><span class="badge badge-${(d.status||'pendente').toLowerCase()==='pago'?'success':'warn'}">${d.status||'Pendente'}</span></td>
    </tr>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ENCARGOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderEnc() {
  const tb = document.getElementById('tb-enc');
  if (!DATA.encargos.length) {
    tb.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
    return;
  }
  tb.innerHTML = [...DATA.encargos].reverse().map(e => `
    <tr>
      <td>${MESES[NUM(e.mes)]}/${e.ano}</td>
      <td>${R(e.baseCalculo)}</td>
      <td>${R(NUM(e.fgts8) + NUM(e.fgts32))}</td>
      <td>${R(NUM(e.inssPatronal) + NUM(e.rat) + NUM(e.inssFunc))}</td>
      <td style="font-weight:600">${R(e.total)}</td>
      <td style="font-size:12px">${fmtDate(e.vencimento)}</td>
      <td><span class="badge badge-${(e.status||'pendente').toLowerCase()==='pago'?'success':'warn'}">${e.status||'Pendente'}</span></td>
    </tr>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FALTAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFaltas() {
  const tb = document.getElementById('tb-faltas');
  if (!DATA.faltas.length) {
    tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-light)">Nenhum registro</td></tr>';
    return;
  }
  tb.innerHTML = [...DATA.faltas].reverse().map(f => {
    const just = f.justificada === 'Sim' || f.justificada === true;
    return `
      <tr>
        <td>${fmtDate(f.data)}</td>
        <td>${f.tipo||'Falta'}</td>
        <td>${f.dias}</td>
        <td><span class="badge badge-${just?'success':'danger'}">${just?'Sim':'N√£o'}</span></td>
        <td style="${!just?'font-weight:600;color:var(--danger)':'color:var(--text-light)'}">${R(f.desconto)}</td>
      </tr>
    `;
  }).join('');
}

function openModalFalta() {
  const now = new Date();
  const today = `${now.getFullYear()}-${PAD(now.getMonth()+1)}-${PAD(now.getDate())}`;
  openModal(`
    <div class="modal-title">Registrar Falta</div>
    <div class="form-inline">
      <div class="form-row">
        <label>Data</label>
        <input type="date" id="m-fal-data" value="${today}">
      </div>
      <div class="form-row">
        <label>Dias</label>
        <input type="number" id="m-fal-dias" value="1" step="0.5">
      </div>
    </div>
    <div class="form-row">
      <label>Tipo</label>
      <select id="m-fal-tipo">
        <option>Falta Simples</option>
        <option>Atestado M√©dico</option>
        <option>Licen√ßa</option>
      </select>
    </div>
    <div class="form-row">
      <label>Justificada?</label>
      <select id="m-fal-just">
        <option value="N√£o">N√£o</option>
        <option value="Sim">Sim</option>
      </select>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="saveFalta()">Salvar</button>
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

async function saveFalta() {
  const salario = NUM(CFG.salario);
  const data = document.getElementById('m-fal-data').value;
  const dias = NUM(document.getElementById('m-fal-dias').value);
  const tipo = document.getElementById('m-fal-tipo').value;
  const just = document.getElementById('m-fal-just').value;
  const desconto = just === 'N√£o' ? salario / 30 * dias : 0;
  
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Salvando...';
  
  const row = { data, dias, tipo, justificada: just, desconto };
  try {
    await writeSheet('saveFalta', row);
    toast('Salvo!','success');
    closeModal();
    await loadAllData();
    renderFaltas();
  } catch(e) { 
    toast('Erro: '+e.message,'error');
    btn.disabled = false;
    btn.textContent = 'Salvar';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESCIS√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcResc() {
  const salario = NUM(CFG.salario);
  const admissao = dateFromStr(CFG.admissao);
  const dataResc = dateFromStr(document.getElementById('resc-data')?.value);
  const tipo = document.getElementById('resc-tipo')?.value;
  const fgtsAcum = NUM(document.getElementById('resc-fgts')?.value);

  if (!dataResc || isNaN(dataResc) || !admissao) {
    document.getElementById('resc-calc').innerHTML = '<div style="color:var(--text-light)">Preencha os dados</div>';
    return;
  }

  const meses = diffMonths(admissao, dataResc);
  const diasMes = dataResc.getDate();
  const avos13 = Math.min(meses % 12 + (diasMes >= 15 ? 1 : 0), 12);
  const avosFerias = meses % 12 + (diasMes >= 15 ? 1 : 0);

  const saldo = salario / 30 * diasMes;
  const aviso = tipo === 'sjc' ? salario : 0;
  const decimoProp = salario / 12 * avos13;
  const feriasProp = salario / 12 * avosFerias * (20/12);
  const feriasTerco = feriasProp / 3;

  let multaFGTS = 0;
  if (tipo === 'sjc') multaFGTS = fgtsAcum * 0.4;
  if (tipo === 'acordo') multaFGTS = fgtsAcum * 0.2;

  const totalBruto = saldo + aviso + decimoProp + feriasProp + feriasTerco + multaFGTS;
  const inss = calcINSS(saldo + decimoProp + feriasProp + feriasTerco);
  const total = totalBruto - inss;

  document.getElementById('resc-calc').innerHTML = `
    <div style="font-weight:600;margin-bottom:12px">Verbas Rescis√≥rias</div>
    <div class="calc-row"><span>Saldo de Sal√°rio</span><span>${R(saldo)}</span></div>
    ${tipo==='sjc' ? `<div class="calc-row"><span>Aviso Pr√©vio Inden.</span><span>${R(aviso)}</span></div>` : ''}
    <div class="calc-row"><span>13¬∞ Proporcional</span><span>${R(decimoProp)}</span></div>
    <div class="calc-row"><span>F√©rias Proporcionais</span><span>${R(feriasProp)}</span></div>
    <div class="calc-row"><span>+ 1/3 s/ F√©rias</span><span>${R(feriasTerco)}</span></div>
    ${multaFGTS ? `<div class="calc-row"><span>Multa FGTS ${tipo==='sjc'?'40%':'20%'}</span><span>${R(multaFGTS)}</span></div>` : ''}
    <div class="calc-row"><span>‚àí INSS</span><span style="color:var(--danger)">‚àí ${R(inss)}</span></div>
    <div class="calc-row total"><span>Total L√≠quido</span><span>${R(total)}</span></div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goTo(view) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('view-' + view)?.classList.add('active');
  document.querySelector(`[data-view="${view}"]`)?.classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(html) {
  document.getElementById('modal-content').innerHTML = html;
  document.getElementById('modal-bg').classList.add('open');
}
function closeModal(e) {
  if (e && e.target !== document.getElementById('modal-bg')) return;
  document.getElementById('modal-bg').classList.remove('open');
  setTimeout(() => {
    document.getElementById('modal-content').innerHTML = '';
  }, 300);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg, type='info') {
  const icons = { success:'‚úÖ', error:'‚ùå', info:'‚ÑπÔ∏è' };
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${icons[type]||'‚ÑπÔ∏è'}</span><span>${msg}</span>`;
  document.getElementById('toast-wrap').appendChild(el);
  setTimeout(() => el.remove(), 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOADER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showLoader() {
  document.getElementById('loader').style.display = 'flex';
}
function hideLoader() {
  document.getElementById('loader').style.display = 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATUS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setStatus(ok) {
  document.getElementById('status-dot').className = 'status-dot ' + (ok ? 'ok' : '');
  document.getElementById('status-label').textContent = ok ? 'Online' : 'Offline';
  if (ok) {
    const now = new Date();
    document.getElementById('sync-time').textContent = `Sync: ${PAD(now.getHours())}:${PAD(now.getMinutes())}`;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DEBUG (console)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.debugData = () => {
  console.log('=== DEBUG DATA ===');
  console.log('CFG:', CFG);
  console.log('Horas Extras:', DATA.horasExtras);
  console.log('Pagamentos:', DATA.pagamentos);
  console.log('F√©rias:', DATA.ferias);
  console.log('Total H.E.:', DATA.horasExtras.length);
  const hePend = DATA.horasExtras.filter(h => (h.status||'').toLowerCase() === 'pendente');
  console.log('H.E. Pendentes:', hePend.length);
  console.log('==================');
  return DATA;
};
</script>
</body>
</html>
